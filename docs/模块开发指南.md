# æ¨¡å—å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•å¼€å‘ Atlas æ¨¡å—ï¼ŒåŒ…æ‹¬ä»ç°æœ‰ GitHub é¡¹ç›®æ”¹é€ ã€æ—¥å¿—ç³»ç»Ÿã€è®¾ç½®ç³»ç»Ÿç­‰å†…å®¹ã€‚

---

## ğŸ“¦ æ”¹é€  GitHub é¡¹ç›®å®æˆ˜æŒ‡å—

### åœºæ™¯ï¼šæ”¹é€ ä¸€ä¸ªå‘½ä»¤è¡Œä¸‹è½½å™¨

**åŸå§‹é¡¹ç›®**ï¼ˆçº¯å‘½ä»¤è¡Œï¼‰ï¼š
```bash
# åŸå§‹ç”¨æ³•
python download.py --url https://example.com/file.zip --output ./downloads
```

**æ”¹é€ ç›®æ ‡**ï¼š
- æä¾›å¯è§†åŒ–ç•Œé¢
- æ˜¾ç¤ºä¸‹è½½è¿›åº¦
- æ”¯æŒå¤šä»»åŠ¡ç®¡ç†

---

### æ­¥éª¤ 1ï¼šåˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„

```bash
mkdir downloader-module
cd downloader-module
mkdir ui backend
```

---

### æ­¥éª¤ 2ï¼šç¼–å†™ manifest.json

```json
{
  "id": "downloader-module",
  "name": "é€šç”¨ä¸‹è½½å™¨",
  "version": "1.0.0",
  "backend": {
    "language": "python",
    "entrypoint": "backend/main.py",
    "startCommand": "python {entrypoint} --port {port}",
    "healthCheck": {
      "endpoint": "/health",
      "interval": 5000
    }
  },
  "ui": {
    "entrypoint": "ui/index.tsx"
  },
  "features": {
    "taskManager": true,
    "logging": true
  }
}
```

---

### æ­¥éª¤ 3ï¼šå°è£…åŸæœ‰é€»è¾‘ä¸º HTTP API

```python
# backend/main.py
from flask import Flask, request, jsonify
from flask_cors import CORS
import argparse
import threading

# å¯¼å…¥åŸæœ‰çš„ä¸‹è½½é€»è¾‘
from download import download_file  # åŸé¡¹ç›®çš„æ ¸å¿ƒå‡½æ•°

app = Flask(__name__)
CORS(app)

# ===== å¿…é¡»æ¥å£ =====
@app.route('/health')
def health():
    return {'status': 'ok'}

# ===== ä¸šåŠ¡ API =====
@app.route('/api/download', methods=['POST'])
def api_download():
    data = request.json
    url = data.get('url')
    output = data.get('output', './downloads')
    
    # å¼‚æ­¥å¯åŠ¨ä¸‹è½½ï¼ˆä¸é˜»å¡å“åº”ï¼‰
    thread = threading.Thread(target=download_file, args=(url, output))
    thread.start()
    
    return jsonify({'success': True, 'message': 'ä¸‹è½½å·²å¼€å§‹'})

@app.route('/api/tasks', methods=['GET'])
def get_tasks():
    # è¿”å›å½“å‰ä¸‹è½½ä»»åŠ¡åˆ—è¡¨ï¼ˆéœ€è¦è‡ªå·±ç»´æŠ¤çŠ¶æ€ï¼‰
    return jsonify({'tasks': []})

# ===== å¯åŠ¨æœåŠ¡ =====
if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--port', type=int, required=True)
    args = parser.parse_args()
    
    app.run(host='127.0.0.1', port=args.port, debug=False)
```

---

### æ­¥éª¤ 4ï¼šåˆ›å»º React UI

```tsx
// ui/index.tsx
import React, { useState } from 'react';

export default function DownloaderUI({ apiClient, onNotify, onTaskStart, onTaskProgress }) {
  const [url, setUrl] = useState('');
  const [output, setOutput] = useState('./downloads');
  
  const handleDownload = async () => {
    if (!url) {
      onNotify('è¯·è¾“å…¥ä¸‹è½½é“¾æ¥', 'warning');
      return;
    }
    
    const taskId = onTaskStart(`ä¸‹è½½: ${url}`);
    
    try {
      const result = await apiClient.post('/api/download', { url, output });
      onNotify('ä¸‹è½½å·²å¼€å§‹', 'success');
      
      // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°ï¼ˆå®é™…é¡¹ç›®éœ€è¦WebSocketæˆ–è½®è¯¢ï¼‰
      let progress = 0;
      const interval = setInterval(() => {
        progress += 10;
        onTaskProgress(taskId, progress);
        if (progress >= 100) clearInterval(interval);
      }, 1000);
      
    } catch (error) {
      onNotify('ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
    }
  };
  
  return (
    <div style={{ padding: '20px' }}>
      <h2>é€šç”¨ä¸‹è½½å™¨</h2>
      
      <div style={{ marginBottom: '15px' }}>
        <label>ä¸‹è½½é“¾æ¥ï¼š</label><br/>
        <input 
          type="text" 
          value={url} 
          onChange={e => setUrl(e.target.value)}
          placeholder="https://example.com/file.zip"
          style={{ width: '400px', padding: '8px' }}
        />
      </div>
      
      <div style={{ marginBottom: '15px' }}>
        <label>ä¿å­˜è·¯å¾„ï¼š</label><br/>
        <input 
          type="text" 
          value={output} 
          onChange={e => setOutput(e.target.value)}
          style={{ width: '400px', padding: '8px' }}
        />
      </div>
      
      <button 
        onClick={handleDownload}
        style={{ 
          padding: '10px 20px', 
          background: '#3B82F6', 
          color: 'white',
          border: 'none',
          borderRadius: '5px',
          cursor: 'pointer'
        }}
      >
        å¼€å§‹ä¸‹è½½
      </button>
    </div>
  );
}
```

---

### æ­¥éª¤ 5ï¼šæµ‹è¯•æ¨¡å—

```bash
# 1. å°†æ¨¡å—æ”¾å…¥ Atlas çš„ modules/ ç›®å½•
cp -r downloader-module ./modules/

# 2. é‡å¯ Atlas åº”ç”¨
npm run dev

# 3. åœ¨ä¾§è¾¹æ æŸ¥çœ‹æ–°æ¨¡å—
```

---

## ğŸ“ æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—

### å‰ç«¯æ—¥å¿—

```tsx
export default function MyModule({ logger }) {
  const handleAction = () => {
    logger.info('ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®');
    logger.debug('å½“å‰çŠ¶æ€', { url: 'https://example.com' });
    logger.warn('è­¦å‘Šï¼šé…ç½®æœªå®Œæˆ');
    logger.error('å‘ç”Ÿé”™è¯¯', { error: 'Network timeout' });
  };
  
  return <button onClick={handleAction}>æ“ä½œ</button>;
}
```

### åç«¯æ—¥å¿—

**æ–¹å¼1ï¼šå†™å…¥æœ¬åœ°æ—¥å¿—æ–‡ä»¶**
```python
import logging

logging.basicConfig(
    filename='logs/module.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

logging.info('æ¨¡å—å¯åŠ¨æˆåŠŸ')
logging.error('ä¸‹è½½å¤±è´¥', exc_info=True)
```

**æ–¹å¼2ï¼šé€šè¿‡HTTPæ¨é€åˆ°æ¡†æ¶ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰**
```python
import requests

def log_to_framework(level, message):
    requests.post('http://localhost:7777/framework/log', json={
        'moduleId': 'downloader-module',
        'level': level,
        'message': message
    })
```

---

## âš™ï¸ è®¾ç½®ç³»ç»Ÿä½¿ç”¨æŒ‡å—

### åœ¨ manifest.json ä¸­å£°æ˜è®¾ç½®é¡¹

```json
{
  "settings": {
    "maxThreads": {
      "type": "number",
      "label": "æœ€å¤§çº¿ç¨‹æ•°",
      "default": 5,
      "min": 1,
      "max": 20,
      "description": "åŒæ—¶ä¸‹è½½çš„æœ€å¤§ä»»åŠ¡æ•°"
    },
    "downloadPath": {
      "type": "directory",
      "label": "ä¸‹è½½ç›®å½•",
      "default": "./downloads"
    },
    "enableNotification": {
      "type": "boolean",
      "label": "å¯ç”¨é€šçŸ¥",
      "default": true
    }
  }
}
```

### UI ä¸­è¯»å–è®¾ç½®

```tsx
export default function MyModule({ storage }) {
  const [maxThreads, setMaxThreads] = useState(5);
  
  useEffect(() => {
    // è¯»å–ç”¨æˆ·é…ç½®
    storage.getConfig('maxThreads').then(value => {
      setMaxThreads(value || 5);
    });
  }, []);
  
  const handleSave = async () => {
    // ä¿å­˜ç”¨æˆ·é…ç½®
    await storage.setConfig('maxThreads', maxThreads);
    onNotify('è®¾ç½®å·²ä¿å­˜', 'success');
  };
  
  return (
    <div>
      <label>
        æœ€å¤§çº¿ç¨‹æ•°ï¼š
        <input 
          type="number" 
          value={maxThreads} 
          onChange={e => setMaxThreads(e.target.value)}
        />
      </label>
      <button onClick={handleSave}>ä¿å­˜</button>
    </div>
  );
}
```

---

## ğŸ” è°ƒè¯•æ¨¡å—

### ç‹¬ç«‹è¿è¡Œåç«¯

```bash
# å¯åŠ¨åç«¯æœåŠ¡
python backend/main.py --port 8080

# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/health

# æµ‹è¯•ä¸šåŠ¡API
curl -X POST http://localhost:8080/api/download \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com/file.zip"}'
```

### åœ¨ Atlas ä¸­æŸ¥çœ‹æ—¥å¿—

æ¨¡å—æ—¥å¿—ä¼šè¾“å‡ºåˆ°ï¼š
- æ§åˆ¶å°ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
- `logs/modules/[module-id]/` ç›®å½•ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é«˜çº§åŠŸèƒ½.md](./é«˜çº§åŠŸèƒ½.md) - å¤šçº§èœå•ã€WebSocket ç­‰
- [æŠ€æœ¯å®ç°.md](./æŠ€æœ¯å®ç°.md) - Tauri IPCã€åŠ¨æ€åŠ è½½ç­‰æŠ€æœ¯ç»†èŠ‚
