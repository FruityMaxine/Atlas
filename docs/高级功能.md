# é«˜çº§åŠŸèƒ½

æœ¬æ–‡æ¡£ä»‹ç» Atlas æ¨¡å—çš„é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤šçº§èœå•ã€WebSocket å®æ—¶é€šä¿¡ç­‰ã€‚

---

## ğŸ—‚ï¸ å¤šçº§èœå•å®ç°æŒ‡å—

æ¨¡å—UIå¯ä»¥è‡ªå·±å®ç°å¤šçº§èœå•å¯¼èˆªï¼š

```tsx
export default function ComplexModule({ apiClient, onNotify }) {
  const [currentPage, setCurrentPage] = useState('home');
  
  const renderContent = () => {
    switch (currentPage) {
      case 'home':
        return <HomePage />;
      case 'settings':
        return <SettingsPage />;
      case 'downloader':
        return <DownloaderPage apiClient={apiClient} />;
      case 'history':
        return <HistoryPage />;
      default:
        return <div>æœªçŸ¥é¡µé¢</div>;
    }
  };
  
  return (
    <div style={{ display: 'flex', height: '100%' }}>
      {/* å·¦ä¾§èœå• */}
      <nav style={{ width: '200px', background: '#f0f0f0', padding: '10px' }}>
        <ul style={{ listStyle: 'none', padding: 0 }}>
          <li>
            <button onClick={() => setCurrentPage('home')}>ä¸»é¡µ</button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('downloader')}>ä¸‹è½½å™¨</button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('history')}>å†å²è®°å½•</button>
          </li>
          <li>
            <button onClick={() => setCurrentPage('settings')}>è®¾ç½®</button>
          </li>
        </ul>
      </nav>
      
      {/* å³ä¾§å†…å®¹ */}
      <main style={{ flex: 1, padding: '20px' }}>
        {renderContent()}
      </main>
    </div>
  );
}
```

---

## ğŸ”Œ WebSocket å®æ—¶é€šä¿¡ï¼ˆè§„åˆ’ä¸­ï¼‰

### åç«¯ WebSocket æœåŠ¡

```python
from flask import Flask
from flask_socketio import SocketIO, emit

app = Flask(__name__)
socketio = SocketIO(app, cors_allowed_origins="*")

@socketio.on('connect')
def handle_connect():
    print('Client connected')

@socketio.on('start_download')
def handle_download(data):
    url = data['url']
    # å¯åŠ¨ä¸‹è½½ï¼Œå¹¶å®æ—¶æ¨é€è¿›åº¦
    for progress in range(0, 101, 10):
        emit('progress', {'progress': progress})
        time.sleep(1)

if __name__ == '__main__':
    socketio.run(app, host='127.0.0.1', port=8080)
```

### å‰ç«¯ WebSocket å®¢æˆ·ç«¯

```tsx
import io from 'socket.io-client';

export default function DownloaderUI({ onTaskProgress }) {
  const [socket, setSocket] = useState(null);
  
  useEffect(() => {
    const newSocket = io('http://localhost:8080');
    
    newSocket.on('progress', (data) => {
      onTaskProgress(taskId, data.progress);
    });
    
    setSocket(newSocket);
    
    return () => newSocket.close();
  }, []);
  
  const handleDownload = () => {
    socket.emit('start_download', { url: 'https://example.com/file.zip' });
  };
  
  return <button onClick={handleDownload}>ä¸‹è½½</button>;
}
```

---

## ğŸ”” æ¶ˆæ¯æ€»çº¿ï¼ˆæœªæ¥åŠŸèƒ½ï¼‰

æ¨¡å—ä¹‹é—´é€šè¿‡æ¶ˆæ¯æ€»çº¿é€šä¿¡ï¼š

```tsx
// æ¨¡å— A å‘é€æ¶ˆæ¯
export default function ModuleA({ messageBus }) {
  const sendMessage = () => {
    messageBus.publish('file-downloaded', {
      filename: 'example.zip',
      path: './downloads/example.zip'
    });
  };
}

// æ¨¡å— B æ¥æ”¶æ¶ˆæ¯
export default function ModuleB({ messageBus }) {
  useEffect(() => {
    const unsubscribe = messageBus.subscribe('file-downloaded', (data) => {
      console.log('æ”¶åˆ°æ–‡ä»¶:', data.filename);
    });
    
    return unsubscribe;
  }, []);
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¨¡å—å¼€å‘æŒ‡å—.md](./æ¨¡å—å¼€å‘æŒ‡å—.md) - åŸºç¡€å¼€å‘æµç¨‹
- [æŠ€æœ¯å®ç°.md](./æŠ€æœ¯å®ç°.md) - æŠ€æœ¯å®ç°ç»†èŠ‚
